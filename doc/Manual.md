# DH-Ping 用户手册

DH-Ping 是一个小工具，用于检测 Dread Hunger 服务器是否能联通。

**重要须知：如果检测远程服务器，服务器管理方可以看到你的 IP 地址：**

``` plaintext
LogNet: NotifyAcceptingConnection accepted from: 123.45.67.89:43210
```

## 下载和启动

首先，你需要在 [Releases 页面](https://github.com/Lurito/dh-ping/releases) 中下载最新版本的 DH-Ping。

你需要确定 **需要运行的电脑** 是什么操作系统：
 - 如果是 Windows 系统，请下载 `windows-amd64` 后缀的；
 - 如果是 Linux 系统，请下载 `linux-amd64` 后缀的。

### Windows 系统的启动

下载完成后，需要先解压缩 `.zip` 文件，会得到一个 `dh-ping.exe` 文件。

双击程序即可启动，并进入交互性模式。

### Linux 系统的启动

下载完成后，用 `cd` 命令切换到 `.zip` 文件所在目录。然后执行 `unzip dh-ping_linux-amd64.zip` 进行解压缩，会得到一个 `dh-ping` 文件。

如果因为 `unzip` 未安装而报错，请自行在互联网上搜索如何安装。

解压完成后，执行 `chmod +x ./dh-ping` 给予程序执行权限。再执行 `./dh-ping` 即可启动程序，并进入交互性模式。

### 命令行模式（仅供有需求的用户使用）

执行 `./dh-ping <IP:端口>` 可以直接在命令行内执行该程序，更多信息请参阅 `./dh-ping help`。

## 开始检测

### 如何判断是否联通

首先，我们需要明白怎样的检测结果，表示服务器是可以正常连接的，而怎样是不能的。

以交互性模式举例，我们在命令行中输入了 `IP:端口` 并回车后，程序会显示一些信息（示例中的数据经过处理）：

``` plaintext
DH-Ping > 127.0.0.1:7777
数据已发送到 127.0.0.1:7777
收到数据:
  00000000: 0000 1111 2222 3333 4444 5555 6666 7777 
  00000010: 8888 9999 aaaa bbbb cccc dddd ee
```

在上面的例子中，我们可以看到，程序收到了服务器返回的数据。通常而言，这表示服务器是可以正常连接的。

```plaintext
DH-Ping > 127.0.0.1:8888
数据已发送到 127.0.0.1:8888
[未收到任何数据]
```

而在这个例子中，程序没有收到任何数据，说明程序无法与服务器通信。通常而言，这意味着游戏也不能连接这一服务器。

## 服务器连接不上的检测流程

如果发现一台服务器无法连接，我们可以按这样的流程依次检查。

首先，我们需要知道服务器程序开在哪个端口上。我们可以在服务器程序（就是那个“一直跳字的黑窗口”）上找到如下字样：

``` plaintext
LogNet: Created socket for bind address: 0.0.0.0 on port 7777
```

这就表示我们的服务器开在端口 7777 上。

你需要自行在服务器程序上寻找端口号，如果你的端口不是 7777，按教程指引输入命令时，需要对应修改端口号。

然后，我们在 **<u>服务器上</u>** 运行程序，按照如下顺序检测：
1. 检测 `127.0.0.1:7777`；
2. 检测 `<内网 IP>:7777`；
3. 检测 `<公网 IP>:7777`。

你的内网 IP 地址和公网 IP 地址通常可以在服务器运营商（例如阿里云）的网站面板上找到。`<公网 IP>:<端口>` 也就是游戏内进入服务器时，输入的那串字符。

如果你在游戏内无法进入服务器，通常意味着其中至少有一个检测不会收到数据。处理方案分别如下：
1. 如果你在检测 `127.0.0.1:7777` 时未收到数据，你需要检查：
    - 确定是在 **<u>服务器上</u>** 运行的检测程序吗？
    - 服务器程序是否正常在启动状态？你通常可以在服务器程序中看到 `(Engine Initialization) Total time: 4.36 seconds` 类似的字样。
    - 是否确实按照上面的指引，找对了端口号？
    - 在 `查找端口号` 的步骤中，是否显示 `bind address: 0.0.0.0`？
    - 如果是 Windows 系统，检查一下服务器程序的左上角是否有“选择”两个字？如果是，请单机服务器程序窗口，并单机键盘上的 Ctrl+C，然后重新检测。
2. 如果你在检测 `<内网 IP>:7777` 时未收到数据，你需要检查：
    - 内网 IP 地址是否输入正确？
    - 服务器防火墙是否关闭？可在搜索引擎中查询 `某系统如何关闭防火墙`；如果有一定经验的用户，建议不要关闭防火墙，而是在防火墙规则中设置放行；
    - 如果设置了端口转发，端口转发是否设置反了？
    - 在 `查找端口号` 的步骤中，是否显示 `bind address: 0.0.0.0`？
    - 在服务器运营商的面板中，防火墙或安全组是否配置正确？
3. 如果你在检测 `<公网 IP>:7777` 时未收到数据，你需要检查：
    - 公网 IP 地址是否输入正确？
    - 在服务器运营商的面板中，防火墙或安全组是否配置正确？公网带宽是否正常开启？
    - 服务器运营商的网络状况是否正常？
    - 或许可以向服务器运营商的客服咨询这一情况。

## 分享软件

你可以在不对程序进行修改的情况下，自由地向任何人分享此程序。你也可以在符合 GNU LGPL-3.0 许可证的情况下，修改和分发此程序。

但本项目在以上协议之上，存在补充条款：针对 lurito/dh-ping 项目，如果您未对程序做有意义的改进，您不得删除、修改程序中的作者署名，也不得向其中增添作者名。
